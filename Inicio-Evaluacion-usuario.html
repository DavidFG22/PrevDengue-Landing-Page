<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Evaluación Express - PrevDengue</title>

    <link rel="stylesheet" href="styles.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:opsz,wght@6..12,300;400;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
  </head>
  <body class="bg-gray">
    <div class="triage-wrapper">
      <div class="triage-header-nav">
        <a href="Inicio-usuario.html" class="back-link">
          <i class="fa-solid fa-arrow-left"></i> Volver al inicio
        </a>
      </div>

      <div class="triage-container">
        <div class="triage-card">
          <div class="triage-intro">
            <div class="icon-header health-bg">
              <i class="fa-solid fa-user-doctor"></i>
            </div>
            <h1>Evaluación de Síntomas</h1>
            <p>
              Selecciona los síntomas que presentas actualmente para recibir una
              recomendación.
            </p>
          </div>

          <form id="triageForm">
            <div class="symptom-group">
              <h3>Síntomas Generales</h3>

              <label class="checkbox-card">
                <input type="checkbox" name="symptom" value="fiebre" />
                <div class="card-content">
                  <span class="check-title">Fiebre Alta</span>
                  <span class="check-desc">Temperatura mayor a 38°C.</span>
                </div>
                <div class="checkmark-circle"></div>
              </label>

              <label class="checkbox-card">
                <input type="checkbox" name="symptom" value="dolor_cuerpo" />
                <div class="card-content">
                  <span class="check-title">Dolor Muscular / Articular</span>
                  <span class="check-desc"
                    >Dolor intenso en el cuerpo o detrás de los ojos.</span
                  >
                </div>
                <div class="checkmark-circle"></div>
              </label>

              <label class="checkbox-card">
                <input type="checkbox" name="symptom" value="sarpullido" />
                <div class="card-content">
                  <span class="check-title">Sarpullido</span>
                  <span class="check-desc">Manchas rojas en la piel.</span>
                </div>
                <div class="checkmark-circle"></div>
              </label>
            </div>

            <div class="symptom-group warning-group">
              <h3>⚠️ Signos de Alarma (Importante)</h3>

              <label class="checkbox-card warning-card">
                <input type="checkbox" name="alarm" value="dolor_abdominal" />
                <div class="card-content">
                  <span class="check-title">Dolor Abdominal Intenso</span>
                  <span class="check-desc"
                    >Dolor continuo y fuerte en el estómago.</span
                  >
                </div>
                <div class="checkmark-circle red"></div>
              </label>

              <label class="checkbox-card warning-card">
                <input type="checkbox" name="alarm" value="sangrado" />
                <div class="card-content">
                  <span class="check-title">Sangrado</span>
                  <span class="check-desc"
                    >Encías, nariz, vómitos o heces negras.</span
                  >
                </div>
                <div class="checkmark-circle red"></div>
              </label>
            </div>

            <button type="submit" class="btn-submit-triage">
              Evaluar Ahora
            </button>
          </form>
        </div>

        <div id="resultSection" class="result-section hidden">
          <div id="resultCard" class="result-card"></div>

          <div class="health-map-container">
            <h3>
              <i class="fa-solid fa-location-dot"></i> Centros de Salud Cercanos
            </h3>
            <p>Acude al establecimiento más próximo para descartar Dengue.</p>
            <div id="health-map"></div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <script>
      // 1. Lógica del Triaje
      const form = document.getElementById("triageForm");
      const resultSection = document.getElementById("resultSection");
      const resultCard = document.getElementById("resultCard");
      let mapInitialized = false;
      let healthMap;

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const symptoms = document.querySelectorAll(
          'input[name="symptom"]:checked'
        );
        const alarms = document.querySelectorAll('input[name="alarm"]:checked');

        let htmlContent = "";
        let resultClass = "";

        // Lógica de decisión basada en HU50 [cite: 3478]
        if (alarms.length > 0) {
          // CASO ROJO: EMERGENCIA
          resultClass = "emergency";
          htmlContent = `
                    <div class="result-icon icon-red"><i class="fa-solid fa-truck-medical"></i></div>
                    <h2>¡ATENCIÓN MÉDICA URGENTE!</h2>
                    <p>Presentas <strong>SIGNOS DE ALARMA</strong>. Debes acudir inmediatamente a Emergencias.</p>
                    <div class="recommendation">
                        <i class="fa-solid fa-phone"></i> Llama al 106 (SAMU) si no puedes movilizarte.
                    </div>
                `;
        } else if (symptoms.length > 0) {
          // CASO AMARILLO: SOSPECHA
          resultClass = "warning";
          htmlContent = `
                    <div class="result-icon icon-yellow"><i class="fa-solid fa-user-doctor"></i></div>
                    <h2>Caso Sospechoso</h2>
                    <p>Tienes síntomas compatibles con Dengue, pero sin signos de alarma graves por el momento.</p>
                    <div class="recommendation">
                        Hidrátate bien y acude al Centro de Salud para una prueba de descarte. <strong>NO te automediques.</strong>
                    </div>
                `;
        } else {
          // CASO VERDE: BAJO RIESGO
          resultClass = "safe";
          htmlContent = `
                    <div class="result-icon icon-green"><i class="fa-regular fa-face-smile"></i></div>
                    <h2>Riesgo Bajo</h2>
                    <p>No reportas síntomas específicos de Dengue. Mantente alerta si la fiebre aparece.</p>
                    <div class="recommendation">
                        Continúa con las medidas de prevención en casa.
                    </div>
                `;
        }

        // Mostrar Resultado
        resultCard.className = `result-card ${resultClass}`;
        resultCard.innerHTML = htmlContent;
        resultSection.classList.remove("hidden");

        // Scroll hacia el resultado
        resultSection.scrollIntoView({ behavior: "smooth" });

        // Inicializar mapa si es necesario (Amarillo o Rojo)
        if (alarms.length > 0 || symptoms.length > 0) {
          setTimeout(() => {
            initHealthMap();
          }, 500); // Pequeño delay para asegurar que el div es visible
        }
      });

      // 2. Mapa de Centros de Salud (HU37)
      function initHealthMap() {
        if (mapInitialized) return;

        healthMap = L.map("health-map").setView([-11.95, -77.07], 14);

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 19,
          attribution: "© OpenStreetMap",
        }).addTo(healthMap);

        var saludIcon = L.icon({
          iconUrl:
            "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",
          shadowUrl:
            "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41],
        });

        // Marcadores de Hospitales
        L.marker([-11.96, -77.08], { icon: saludIcon })
          .addTo(healthMap)
          .bindPopup("<b>Hospital Sergio Bernales</b><br>Emergencias 24h")
          .openPopup();

        L.marker([-11.94, -77.07], { icon: saludIcon })
          .addTo(healthMap)
          .bindPopup("<b>Posta Médica Santa Luzmila</b><br>Lun-Sab 8am-6pm");

        mapInitialized = true;
      }
    </script>
  </body>
</html>
